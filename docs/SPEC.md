# Sonpo Actuary Flashcard App Specification

## 1. Purpose
This application is a Streamlit-based Q&A drill app for the Japanese Actuary Second Exam (損保).
It uses CSV flashcards generated by NotebookLM and supports free-text answers with automatic scoring.

Target platform: Android (via mobile browser / PWA-style usage).

---

## 2. Tech Stack
- Python 3.10+
- Streamlit
- pandas
- difflib (standard library)
- No external ML or LLM usage

---

## 3. Data Specification

### 3.1 flashcards_*.csv (input)
Located at: data/<folder>/flashcards_*.csv

Folders:
- all (全体)
- 1〜11 (各章)
- A, B

Required columns:

| column     | type   | description |
|-----------|--------|-------------|
| question  | string | question text |
| answer    | string | model answer |

Example:
question,answer
損害保険における危険選択とは何か？,保険契約引受に際して危険度を判定すること


---

### 3.2 progress.csv (auto-generated)
Located at: data/<folder>/progress.csv

| column        | type | description |
|--------------|------|-------------|
| id           | int  | card id (global id from merged cards) |
| score_class  | int  | 0, 1, or 2 |

Score class definition:
- 0 : similarity == 0%
- 1 : 1%–99%
- 2 : 100%

Initial state:
- All cards start as score_class = 0

If progress.csv does not exist in the selected folder, generate it automatically.
Only card ids that exist in the selected folder are stored.

---

## 4. Scoring Logic

### 4.1 Similarity Calculation
Use character-level similarity based on difflib.SequenceMatcher.



similarity = int(SequenceMatcher(None, user_answer, correct_answer).ratio() * 100)


### 4.2 Classification
- similarity == 100 → score_class = 2
- similarity == 0 → score_class = 0
- otherwise → score_class = 1

---

## 5. UI Requirements (Streamlit)

### 5.1 Question Display
- Show exactly one question at a time
- Free-text input for user answer (multiline)

### 5.2 Actions
Buttons:
- "採点" (Score)
- "次の問題" (Next Question)

After scoring:
- Show similarity percentage
- Show model answer
- Update progress.csv

---

## 6. Question Selection Logic

User can select question pool within the selected folder:
- Only score_class = 0
- Only score_class = 1
- Only score_class = 2
- All questions

From the selected pool:
- Randomly select one question
- If pool is empty, display a warning

---

## 7. Session State Rules
- Current question ID must persist until "次の問題" is pressed
- Scoring should not auto-advance
- State must survive Streamlit reruns

---

## 8. Non-Goals (Explicitly Out of Scope)
- Semantic similarity (LLM / embeddings)
- Offline-first support
- iOS native app
- Authentication / user accounts

---

## 9. Code Structure Rules
- main.py only orchestrates UI
- Scoring logic must be in scoring.py
- Question selection logic must be in selector.py
- No logic duplication across files

---

## 10. Expected Outcome
A minimal, stable, and easily extensible Q&A drill app optimized for actuarial exam preparation.
